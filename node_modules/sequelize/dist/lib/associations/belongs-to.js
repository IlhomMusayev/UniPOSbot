"use strict";var l=Object.defineProperty;var c=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable;var K=(r,e,t)=>e in r?l(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,f=(r,e)=>{for(var t in e||(e={}))w.call(e,t)&&K(r,t,e[t]);if(c)for(var t of c(e))m.call(e,t)&&K(r,t,e[t]);return r};var d=(r,e)=>l(r,"name",{value:e,configurable:!0});const u=require("./../utils"),y=require("./helpers"),p=require("lodash"),b=require("./base"),A=require("../operators");class h extends b{constructor(e,t,s){super(e,t,s);if(this.associationType="BelongsTo",this.isSingleAssociation=!0,this.foreignKeyAttribute={},this.as?(this.isAliased=!0,this.options.name={singular:this.as}):(this.as=this.target.options.name.singular,this.options.name=this.target.options.name),p.isObject(this.options.foreignKey)?(this.foreignKeyAttribute=this.options.foreignKey,this.foreignKey=this.foreignKeyAttribute.name||this.foreignKeyAttribute.fieldName):this.options.foreignKey&&(this.foreignKey=this.options.foreignKey),this.foreignKey||(this.foreignKey=u.camelize([this.as,this.target.primaryKeyAttribute].join("_"))),this.identifier=this.foreignKey,this.source.rawAttributes[this.identifier]&&(this.identifierField=this.source.rawAttributes[this.identifier].field||this.identifier),this.options.targetKey&&!this.target.rawAttributes[this.options.targetKey])throw new Error(`Unknown attribute "${this.options.targetKey}" passed as targetKey, define this attribute on model "${this.target.name}" first`);this.targetKey=this.options.targetKey||this.target.primaryKeyAttribute,this.targetKeyField=this.target.rawAttributes[this.targetKey].field||this.targetKey,this.targetKeyIsPrimary=this.targetKey===this.target.primaryKeyAttribute,this.targetIdentifier=this.targetKey,this.associationAccessor=this.as,this.options.useHooks=s.useHooks;const i=p.upperFirst(this.options.name.singular);this.accessors={get:`get${i}`,set:`set${i}`,create:`create${i}`}}_injectAttributes(){const e={[this.foreignKey]:f({type:this.options.keyType||this.target.rawAttributes[this.targetKey].type,allowNull:!0},this.foreignKeyAttribute)};if(this.options.constraints!==!1){const t=this.source.rawAttributes[this.foreignKey]||e[this.foreignKey];this.options.onDelete=this.options.onDelete||(t.allowNull?"SET NULL":"NO ACTION"),this.options.onUpdate=this.options.onUpdate||"CASCADE"}return y.addForeignKeyConstraints(e[this.foreignKey],this.target,this.source,this.options,this.targetKeyField),u.mergeDefaults(this.source.rawAttributes,e),this.source.refreshAttributes(),this.identifierField=this.source.rawAttributes[this.foreignKey].field||this.foreignKey,y.checkNamingCollision(this),this}mixin(e){const t=["get","set","create"];y.mixinMethods(this,e,t)}async get(e,t){const s={};let i=this.target,o;if(t=u.cloneDeep(t),Object.prototype.hasOwnProperty.call(t,"scope")&&(t.scope?i=i.scope(t.scope):i=i.unscoped()),Object.prototype.hasOwnProperty.call(t,"schema")&&(i=i.schema(t.schema,t.schemaDelimiter)),Array.isArray(e)||(o=e,e=void 0),e)s[this.targetKey]={[A.in]:e.map(n=>n.get(this.foreignKey))};else{if(this.targetKeyIsPrimary&&!t.where)return i.findByPk(o.get(this.foreignKey),t);s[this.targetKey]=o.get(this.foreignKey),t.limit=null}if(t.where=t.where?{[A.and]:[s,t.where]}:s,e){const n=await i.findAll(t),g={};for(const a of e)g[a.get(this.foreignKey,{raw:!0})]=null;for(const a of n)g[a.get(this.targetKey,{raw:!0})]=a;return g}return i.findOne(t)}async set(e,t,s={}){let i=t;if(t instanceof this.target&&(i=t[this.targetKey]),e.set(this.foreignKey,i),s.save!==!1)return s=f({fields:[this.foreignKey],allowNull:[this.foreignKey],association:!0},s),await e.save(s)}async create(e,t,s){t=t||{},s=s||{};const i=await this.target.create(t,s);return await e[this.accessors.set](i,s),i}verifyAssociationAlias(e){return typeof e=="string"?this.as===e:e&&e.singular?this.as===e.singular:!this.isAliased}}d(h,"BelongsTo"),module.exports=h,module.exports.BelongsTo=h,module.exports.default=h;
//# sourceMappingURL=belongs-to.js.map
