{
  "version": 3,
  "sources": ["../../../../lib/dialects/mysql/data-types.js"],
  "sourcesContent": ["'use strict';\n\nconst wkx = require('wkx');\nconst _ = require('lodash');\nconst moment = require('moment-timezone');\nmodule.exports = BaseTypes => {\n  BaseTypes.ABSTRACT.prototype.dialectTypes = 'https://dev.mysql.com/doc/refman/5.7/en/data-types.html';\n\n  /**\n   * types: [buffer_type, ...]\n   *\n   * @see buffer_type here https://dev.mysql.com/doc/refman/5.7/en/c-api-prepared-statement-type-codes.html\n   * @see hex here https://github.com/sidorares/node-mysql2/blob/master/lib/constants/types.js\n   */\n\n  BaseTypes.DATE.types.mysql = ['DATETIME'];\n  BaseTypes.STRING.types.mysql = ['VAR_STRING'];\n  BaseTypes.CHAR.types.mysql = ['STRING'];\n  BaseTypes.TEXT.types.mysql = ['BLOB'];\n  BaseTypes.TINYINT.types.mysql = ['TINY'];\n  BaseTypes.SMALLINT.types.mysql = ['SHORT'];\n  BaseTypes.MEDIUMINT.types.mysql = ['INT24'];\n  BaseTypes.INTEGER.types.mysql = ['LONG'];\n  BaseTypes.BIGINT.types.mysql = ['LONGLONG'];\n  BaseTypes.FLOAT.types.mysql = ['FLOAT'];\n  BaseTypes.TIME.types.mysql = ['TIME'];\n  BaseTypes.DATEONLY.types.mysql = ['DATE'];\n  BaseTypes.BOOLEAN.types.mysql = ['TINY'];\n  BaseTypes.BLOB.types.mysql = ['TINYBLOB', 'BLOB', 'LONGBLOB'];\n  BaseTypes.DECIMAL.types.mysql = ['NEWDECIMAL'];\n  BaseTypes.UUID.types.mysql = false;\n  BaseTypes.ENUM.types.mysql = false;\n  BaseTypes.REAL.types.mysql = ['DOUBLE'];\n  BaseTypes.DOUBLE.types.mysql = ['DOUBLE'];\n  BaseTypes.GEOMETRY.types.mysql = ['GEOMETRY'];\n  BaseTypes.JSON.types.mysql = ['JSON'];\n\n  class DECIMAL extends BaseTypes.DECIMAL {\n    toSql() {\n      let definition = super.toSql();\n      if (this._unsigned) {\n        definition += ' UNSIGNED';\n      }\n      if (this._zerofill) {\n        definition += ' ZEROFILL';\n      }\n      return definition;\n    }\n  }\n\n  class DATE extends BaseTypes.DATE {\n    toSql() {\n      return this._length ? `DATETIME(${this._length})` : 'DATETIME';\n    }\n    _stringify(date, options) {\n      date = this._applyTimezone(date, options);\n      // Fractional DATETIMEs only supported on MySQL 5.6.4+\n      if (this._length) {\n        return date.format('YYYY-MM-DD HH:mm:ss.SSS');\n      }\n      return date.format('YYYY-MM-DD HH:mm:ss');\n    }\n    static parse(value, options) {\n      value = value.string();\n      if (value === null) {\n        return value;\n      }\n      if (moment.tz.zone(options.timezone)) {\n        value = moment.tz(value, options.timezone).toDate();\n      }\n      else {\n        value = new Date(`${value} ${options.timezone}`);\n      }\n      return value;\n    }\n  }\n\n  class DATEONLY extends BaseTypes.DATEONLY {\n    static parse(value) {\n      return value.string();\n    }\n  }\n  class UUID extends BaseTypes.UUID {\n    toSql() {\n      return 'CHAR(36) BINARY';\n    }\n  }\n\n  const SUPPORTED_GEOMETRY_TYPES = ['POINT', 'LINESTRING', 'POLYGON'];\n\n  class GEOMETRY extends BaseTypes.GEOMETRY {\n    constructor(type, srid) {\n      super(type, srid);\n      if (_.isEmpty(this.type)) {\n        this.sqlType = this.key;\n        return;\n      }\n      if (SUPPORTED_GEOMETRY_TYPES.includes(this.type)) {\n        this.sqlType = this.type;\n        return;\n      }\n      throw new Error(`Supported geometry types are: ${SUPPORTED_GEOMETRY_TYPES.join(', ')}`);\n    }\n    static parse(value) {\n      value = value.buffer();\n      // Empty buffer, MySQL doesn't support POINT EMPTY\n      // check, https://dev.mysql.com/worklog/task/?id=2381\n      if (!value || value.length === 0) {\n        return null;\n      }\n      // For some reason, discard the first 4 bytes\n      value = value.slice(4);\n      return wkx.Geometry.parse(value).toGeoJSON({ shortCrs: true });\n    }\n    toSql() {\n      return this.sqlType;\n    }\n  }\n\n  class ENUM extends BaseTypes.ENUM {\n    toSql(options) {\n      return `ENUM(${this.values.map(value => options.escape(value)).join(', ')})`;\n    }\n  }\n\n  class JSONTYPE extends BaseTypes.JSON {\n    _stringify(value, options) {\n      return options.operation === 'where' && typeof value === 'string' ? value : JSON.stringify(value);\n    }\n  }\n\n  return {\n    ENUM,\n    DATE,\n    DATEONLY,\n    UUID,\n    GEOMETRY,\n    DECIMAL,\n    JSON: JSONTYPE\n  };\n};\n"],
  "mappings": "4FAEA,KAAM,GAAM,QAAQ,OACd,EAAI,QAAQ,UACZ,EAAS,QAAQ,mBACvB,OAAO,QAAU,GAAa,CAC5B,EAAU,SAAS,UAAU,aAAe,0DAS5C,EAAU,KAAK,MAAM,MAAQ,CAAC,YAC9B,EAAU,OAAO,MAAM,MAAQ,CAAC,cAChC,EAAU,KAAK,MAAM,MAAQ,CAAC,UAC9B,EAAU,KAAK,MAAM,MAAQ,CAAC,QAC9B,EAAU,QAAQ,MAAM,MAAQ,CAAC,QACjC,EAAU,SAAS,MAAM,MAAQ,CAAC,SAClC,EAAU,UAAU,MAAM,MAAQ,CAAC,SACnC,EAAU,QAAQ,MAAM,MAAQ,CAAC,QACjC,EAAU,OAAO,MAAM,MAAQ,CAAC,YAChC,EAAU,MAAM,MAAM,MAAQ,CAAC,SAC/B,EAAU,KAAK,MAAM,MAAQ,CAAC,QAC9B,EAAU,SAAS,MAAM,MAAQ,CAAC,QAClC,EAAU,QAAQ,MAAM,MAAQ,CAAC,QACjC,EAAU,KAAK,MAAM,MAAQ,CAAC,WAAY,OAAQ,YAClD,EAAU,QAAQ,MAAM,MAAQ,CAAC,cACjC,EAAU,KAAK,MAAM,MAAQ,GAC7B,EAAU,KAAK,MAAM,MAAQ,GAC7B,EAAU,KAAK,MAAM,MAAQ,CAAC,UAC9B,EAAU,OAAO,MAAM,MAAQ,CAAC,UAChC,EAAU,SAAS,MAAM,MAAQ,CAAC,YAClC,EAAU,KAAK,MAAM,MAAQ,CAAC,QAE9B,eAAsB,GAAU,OAAQ,CACtC,OAAQ,CACN,GAAI,GAAa,MAAM,QACvB,MAAI,MAAK,WACP,IAAc,aAEZ,KAAK,WACP,IAAc,aAET,GATX,eAaA,eAAmB,GAAU,IAAK,CAChC,OAAQ,CACN,MAAO,MAAK,QAAU,YAAY,KAAK,WAAa,WAEtD,WAAW,EAAM,EAAS,CAGxB,MAFA,GAAO,KAAK,eAAe,EAAM,GAE7B,KAAK,QACA,EAAK,OAAO,2BAEd,EAAK,OAAO,6BAEd,OAAM,EAAO,EAAS,CAE3B,MADA,GAAQ,EAAM,SACV,IAAU,MAGd,CAAI,EAAO,GAAG,KAAK,EAAQ,UACzB,EAAQ,EAAO,GAAG,EAAO,EAAQ,UAAU,SAG3C,EAAQ,GAAI,MAAK,GAAG,KAAS,EAAQ,aAEhC,GAvBX,YA2BA,eAAuB,GAAU,QAAS,OACjC,OAAM,EAAO,CAClB,MAAO,GAAM,UAFjB,gBAKA,eAAmB,GAAU,IAAK,CAChC,OAAQ,CACN,MAAO,mBAFX,YAMA,KAAM,GAA2B,CAAC,QAAS,aAAc,WAEzD,eAAuB,GAAU,QAAS,CACxC,YAAY,EAAM,EAAM,CACtB,MAAM,EAAM,GACZ,GAAI,EAAE,QAAQ,KAAK,MAAO,CACxB,KAAK,QAAU,KAAK,IACpB,OAEF,GAAI,EAAyB,SAAS,KAAK,MAAO,CAChD,KAAK,QAAU,KAAK,KACpB,OAEF,KAAM,IAAI,OAAM,iCAAiC,EAAyB,KAAK,eAE1E,OAAM,EAAO,CAIlB,MAHA,GAAQ,EAAM,SAGV,CAAC,GAAS,EAAM,SAAW,EACtB,KAGT,GAAQ,EAAM,MAAM,GACb,EAAI,SAAS,MAAM,GAAO,UAAU,CAAE,SAAU,MAEzD,OAAQ,CACN,MAAO,MAAK,SAzBhB,gBA6BA,eAAmB,GAAU,IAAK,CAChC,MAAM,EAAS,CACb,MAAO,QAAQ,KAAK,OAAO,IAAI,GAAS,EAAQ,OAAO,IAAQ,KAAK,UAFxE,YAMA,eAAuB,GAAU,IAAK,CACpC,WAAW,EAAO,EAAS,CACzB,MAAO,GAAQ,YAAc,SAAW,MAAO,IAAU,SAAW,EAAQ,KAAK,UAAU,IAF/F,uBAMO,CACL,OACA,OACA,WACA,OACA,WACA,UACA,KAAM",
  "names": []
}
